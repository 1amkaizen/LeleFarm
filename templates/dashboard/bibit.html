<!-- templates/dashboard/bibit.html -->
{% extends "dashboard/base.html" %} {% block title %}Kelola Bibit{% endblock %}
{% block content %}


<!-- ===== PAGE HEADER + BREADCRUMB ===== -->
<div class="mb-8 mt-5">
  <!-- Breadcrumb -->
  <nav class="text-sm text-gray-500 mb-2">
    <ol class="flex items-center space-x-2">
      <li class="hover:text-blue-600 transition">
        <i class="fas fa-home mr-1"></i> Dashboard
      </li>
      <li>/</li>
      <li class="text-blue-700 font-semibold">
        Bibit
      </li>
    </ol>
  </nav>

  <!-- Page Title -->
  <div class="flex items-center gap-4 
              bg-gradient-to-r from-blue-500 to-blue-600 
              text-white p-5 rounded-2xl shadow-lg">
    
    <!-- Icon -->
    <div class="bg-white/20 p-3 rounded-xl">
      <i class="fas fa-fish text-2xl"></i>
    </div>

    <!-- Title -->
    <div>
      <h1 class="text-2xl font-bold leading-tight">
        Kelola Bibit
      </h1>
      <p class="text-sm text-blue-100">
        Kelola dan pantau data bibit lele di setiap
      kolam
      </p>
    </div>
  </div>
</div>


{% if request.query_params.get("error") == "kolam_kosong" %}
<div class="mb-4 p-3 rounded bg-red-100 border border-red-300 text-red-700">
  ⚠️ Kolam belum dipilih atau belum ada.
  <br />
  Silakan buat kolam terlebih dahulu sebelum menambah bibit.
</div>
{% endif %}

<!-- Form Tambah Bibit Baru -->
<form action="/dashboard/bibit" method="post" class="bg-white/90 backdrop-blur-2xl p-8 rounded-3xl shadow-[0_20px_50px_rgba(8,_112,_184,_0.1)] border border-white mb-8
         transition-all duration-500 hover:shadow-[0_30px_60px_rgba(8,_112,_184,_0.15)]">

  <div class="flex items-center gap-3 mb-6">
    <div class="h-8 w-1.5 bg-indigo-600 rounded-full"></div>
    <h2 class="text-xl font-bold text-gray-800 tracking-tight">Input Tebar Bibit</h2>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

    <div class="relative group lg:col-span-1" x-data="{ open: false, selected: null }">
      <label class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-water text-blue-500"></i>
        Pilih Kolam
      </label>
      <div class="w-full rounded-2xl border border-gray-200 bg-gray-50/50 px-5 py-3.5 cursor-pointer
               shadow-inner transition-all duration-300 flex justify-between items-center
               hover:border-blue-300 focus-within:ring-4 focus-within:ring-blue-100" @click="open = !open">
        <span class="font-medium text-gray-700" x-text="selected ? selected.nama : 'Pilih lokasi kolam...'"></span>
        <i class="fas fa-chevron-down text-gray-400 transition-transform duration-300"
          :class="open && 'rotate-180'"></i>
      </div>

      <ul x-show="open" x-transition:enter="transition ease-out duration-100"
        x-transition:enter-start="opacity-0 scale-95" x-transition:leave="transition ease-in duration-75"
        @click.outside="open = false" class="absolute left-0 w-full mt-2 bg-white/95 backdrop-blur-xl rounded-2xl border border-gray-100
                 max-h-52 overflow-auto z-[60] shadow-2xl p-2 space-y-1">
        {% for kolam in kolam_list %}
        <li class="px-4 py-2.5 rounded-xl cursor-pointer transition-all duration-200
                   hover:bg-blue-600 hover:text-white font-medium"
          @click="selected = {id: {{ kolam.id }}, nama: '{{ kolam.nama_kolam }}'}; open=false;">
          {{ kolam.nama_kolam }}
        </li>
        {% endfor %}
      </ul>
      <input type="hidden" name="kolam_id" :value="selected ? selected.id : ''" required />
    </div>

    <div class="relative group">
      <label for="ukuran_bibit"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-ruler-combined text-amber-500"></i>
        Ukuran
      </label>
      <select name="ukuran_bibit" id="ukuran_bibit" required class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5 appearance-none
               shadow-inner transition-all duration-300 cursor-pointer
               focus:bg-white focus:border-amber-500 focus:ring-4 focus:ring-amber-100 focus:outline-none">
        <option value="" disabled selected>Pilih ukuran...</option>
        {% for ukuran in ukuran_list %}
        <option value="{{ ukuran }}">{{ ukuran }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="relative group">
      <label for="jumlah"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-sort-numeric-up text-emerald-500"></i>
        Jumlah (Ekor)
      </label>
      <input type="text" name="jumlah" id="jumlah" inputmode="numeric" placeholder="0" required class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5
               shadow-inner transition-all duration-300
               focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 focus:outline-none" />
    </div>

    <div class="relative group">
      <label for="total_berat"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-weight-hanging text-orange-500"></i>
        Total Berat (kg)
      </label>
      <input type="text" name="total_berat" id="total_berat" inputmode="decimal" placeholder="0.00" class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5
               shadow-inner transition-all duration-300
               focus:bg-white focus:border-orange-500 focus:ring-4 focus:ring-orange-100 focus:outline-none" />
    </div>

    <div class="relative group">
      <label for="total_harga"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-coins text-yellow-500"></i>
        Total Harga
      </label>
      <div class="relative">
        <span class="absolute left-4 top-1/2 -translate-y-1/2 font-bold text-gray-400">Rp</span>
        <input type="text" name="total_harga" id="total_harga" inputmode="numeric" placeholder="0" class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-12 py-3.5
                 shadow-inner transition-all duration-300
                 focus:bg-white focus:border-yellow-500 focus:ring-4 focus:ring-yellow-100 focus:outline-none" />
      </div>
    </div>

    <div class="relative group">
      <label for="tanggal_tebar"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-calendar-alt text-indigo-500"></i>
        Tanggal Tebar
      </label>
      <input type="date" name="tanggal_tebar" id="tanggal_tebar" class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5
               shadow-inner transition-all duration-300 cursor-pointer
               focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 focus:outline-none" />
    </div>

    <div class="relative group md:col-span-2 lg:col-span-3">
      <label for="catatan"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-sticky-note text-gray-400"></i>
        Catatan Opsional
      </label>
      <textarea name="catatan" id="catatan" rows="1" placeholder="Info tambahan mengenai bibit..." class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5 resize-none
               shadow-inner transition-all duration-300 min-h-[54px]
               focus:bg-white focus:border-gray-400 focus:ring-4 focus:ring-gray-100 focus:outline-none"></textarea>
    </div>

  </div>

  <div class="mt-8 flex justify-end">
    <button type="submit" class="group w-full md:w-auto px-10 py-4 rounded-2xl font-bold text-white
             bg-blue-600 shadow-xl transition-all duration-300
             hover:bg-indigo-600 hover:-translate-y-1 active:scale-95
             flex items-center justify-center gap-3">
      <i class="fas fa-plus-circle text-lg group-hover:rotate-12 transition-transform"></i>
      Tambah Data Bibit
    </button>
  </div>
</form>

<!-- Ringkasan Total Bibit -->
<hr class="my-6" />
<h2 class="text-xl font-semibold mb-2 flex items-center gap-2 text-blue-900">
  <i class="fas fa-list text-indigo-500"></i> Daftar Bibit
</h2>


<!-- Filter Per Kolam -->
<div class="mb-4">
  <label class="font-semibold text-blue-900 mr-2">Filter Kolam:</label>
  <select id="filterKolam" class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-300">
    <option value="all">Semua Kolam</option>
    {% for kolam in kolam_list %}
    <option value="{{ kolam.id }}">{{ kolam.nama_kolam }}</option>
    {% endfor %}
  </select>
</div>

<div class="overflow-x-auto mb-5 rounded-2xl shadow-lg ring-1 ring-black/5 bg-white">
  <table
    class="table-auto w-full md:min-w-[900px] text-sm text-gray-700"
  >

    <!-- HEADER -->
    <thead class="bg-gradient-to-r from-blue-600 to-blue-500 text-white text-center">
      <tr>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">ID</th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-water mr-1"></i> Kolam
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-calendar-alt mr-1"></i> Tanggal Tebar
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-ruler-combined mr-1"></i> Ukuran
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-sort-numeric-up mr-1"></i> Jumlah
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-weight-hanging mr-1"></i> Total Berat (kg)
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-coins mr-1"></i> Total Harga
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-sticky-note mr-1"></i> Catatan
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap text-center">
          <i class="fas fa-cogs mr-1"></i> Aksi
        </th>
      </tr>
    </thead>

    <!-- BODY -->
    <tbody class="text-center divide-y divide-gray-100 bg-white">
      {% for bibit in bibit_list %}
      <tr class="hover:bg-blue-50/70 transition-all duration-200" data-kolam-id="{{ bibit.kolam_id }}">

        <td class="px-4 py-3 whitespace-nowrap font-medium">
          {{ bibit.id }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap font-semibold text-gray-800">
          {{ bibit.nama_kolam }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap">
          {{ bibit.tanggal_tebar or '-' }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap">
          {{ bibit.ukuran_bibit }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap font-semibold">
          {{ "{:,}".format(bibit.jumlah).replace(',', '.') }} ekor
        </td>

        <td class="px-4 py-3 whitespace-nowrap">
          {{ "{:,}".format(bibit.total_berat or 0).split('.')[0].replace(',', '.') }} kg
        </td>

        <td class="px-4 py-3 whitespace-nowrap font-semibold text-blue-600">
          Rp {{ "{:,.0f}".format(bibit.total_harga or 0).replace(',', '.') }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap text-gray-600 max-w-xs truncate">
          {{ bibit.catatan or '-' }}
        </td>

        <!-- AKSI -->
        <td class="px-4 py-3 whitespace-nowrap">
          <div class="flex flex-nowrap items-center justify-center gap-2">

            <!-- Tombol Edit -->
            <button
              class="inline-flex items-center justify-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-semibold text-white transition
                     bg-yellow-400 hover:bg-yellow-500"
              onclick="BibitTable.openEditModal({{ bibit.id }}, {{ bibit.kolam_id }}, '{{ bibit.ukuran_bibit }}', {{ bibit.jumlah }}, {{ bibit.total_harga }}, '{{ bibit.tanggal_tebar or '' }}', '{{ bibit.catatan or '' }}', {{ bibit.total_berat }})"
            >
              <i class="fas fa-edit"></i>
            </button>

            <!-- Tombol Delete -->
            <button
              type="button"
              class="inline-flex items-center justify-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-semibold text-white transition
                     bg-red-500 hover:bg-red-600"
              onclick="BibitTable.openDeleteModal({{ bibit.id }})"
            >
              <i class="fas fa-trash-alt"></i>
            </button>

          </div>
        </td>
      </tr>
      {% endfor %}


    </tbody>
<tfoot class="bg-blue-50 font-semibold text-center">
  <tr>
    <td class="px-4 py-3 text-left" colspan="4">
      <i class="fas fa-weight-hanging text-yellow-500 mr-1"></i> Total
    </td>
    <td class="px-4 py-3">
      {{ "{:,}".format(total_bibit).replace(',', '.') }} ekor
    </td>
    <td class="px-4 py-3">
      {{ "{:,.0f}".format(total_berat|int).replace(',', '.') }} kg
    </td>
    <td class="px-4 py-3">
      Rp {{ "{:,.0f}".format(total_harga|int).replace(',', '.') }}
    </td>
    <td class="px-4 py-3"></td>
    <td class="px-4 py-3"></td>
  </tr>
</tfoot>

    
  </table>
</div>


<!-- Pagination Controls -->
<div id="paginationControls" class="flex items-center justify-center gap-3 mt-6 mb-6">

  <button id="prevBtn" onclick="BibitTable.changePage('prev')" disabled>
    <i class="fas fa-chevron-left text-sm"></i>
  </button>

  <span
    id="pageInfo"
    class="px-5 py-2 rounded-full bg-blue-100 text-blue-800
           font-semibold text-sm shadow-inner">
    Page 1
  </span>

  <button id="nextBtn" onclick="BibitTable.changePage('next')" disabled>
    <i class="fas fa-chevron-right text-sm"></i>
  </button>

</div>



<!-- Modal Edit Bibit -->
<div
  id="editModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
>
  <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative">
    <h2 class="text-lg font-semibold text-blue-900 mb-4">Edit Bibit</h2>
    <form id="editForm" method="post" action="/dashboard/bibit/edit">
      <input type="hidden" name="bibit_id" id="edit_id" />
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900">Kolam</label>
        <select
          id="edit_kolam"
          name="kolam_id"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300"
        >
          {% for kolam in kolam_list %}
          <option value="{{ kolam.id }}">{{ kolam.nama_kolam }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900"
          >Ukuran Bibit</label
        >
        <select
          id="edit_ukuran"
          name="ukuran_bibit"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300"
        >
          <option value="" disabled>Pilih ukuran...</option>
          {% for ukuran in ukuran_list %}
          <option value="{{ ukuran }}">{{ ukuran }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900"
          >Jumlah Bibit</label
        >
        <input
          type="number"
          id="edit_jumlah"
          name="jumlah"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300"
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900"
          >Total Berat (kg)</label
        >
        <input
          type="number"
          step="0.01"
          id="edit_berat"
          name="total_berat"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300"
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900"
          >Total Harga</label
        >
        <input
          type="number"
          step="0.01"
          id="edit_harga"
          name="total_harga"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300"
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900"
          >Tanggal Tebar</label
        >
        <input
          type="date"
          id="edit_tanggal"
          name="tanggal_tebar"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300"
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900">Catatan</label>
        <textarea
          id="edit_catatan"
          name="catatan"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300"
        ></textarea>
      </div>
      <div class="flex justify-end gap-2">
        <button
          type="button"
          onclick="closeEditModal()"
          class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400"
        >
          Batal
        </button>
        <button
          type="submit"
          class="px-4 py-2 rounded bg-blue-500 hover:bg-blue-600 text-white"
        >
          Simpan
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Delete Bibit -->
<div
  id="deleteModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
>
  <div class="bg-white rounded-lg shadow-lg w-full max-w-sm p-6 relative">
    <h2 class="text-lg font-semibold text-blue-900 mb-4">Hapus Bibit?</h2>
    <form id="deleteForm" method="post" action="/dashboard/bibit/delete">
      <input type="hidden" name="bibit_id" id="delete_id" />
      <div class="flex justify-end gap-2">
        <button
          type="button"
          onclick="closeDeleteModal()"
          class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400"
        >
          Batal
        </button>
        <button
          type="submit"
          class="px-4 py-2 rounded bg-red-500 hover:bg-red-600 text-white"
        >
          Hapus
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  const BibitTable = (() => {
    // ======== Variabel ========
    const rowsPerPage = 5;
    let currentPage = 1;
    const allRows = Array.from(document.querySelectorAll('tbody tr[data-kolam-id]'));
    let filteredRows = allRows.slice(); // awalnya semua row
    const totalRow = document.querySelector("tfoot tr");
    const filterSelect = document.getElementById('filterKolam');

    // ======== Modal ========
    function openEditModal(id, kolam_id, ukuran, jumlah, harga, tanggal, catatan, total_berat) {
      document.getElementById("edit_id").value = id;
      document.getElementById("edit_kolam").value = kolam_id;
      document.getElementById("edit_ukuran").value = ukuran;
      document.getElementById("edit_jumlah").value = jumlah;
      document.getElementById("edit_harga").value = harga;
      document.getElementById("edit_tanggal").value = tanggal;
      document.getElementById("edit_catatan").value = catatan;
      document.getElementById("edit_berat").value = total_berat;
      document.getElementById("editModal").classList.remove("hidden");
    }

    function closeEditModal() {
      document.getElementById("editModal").classList.add("hidden");
    }

    function openDeleteModal(id) {
      document.getElementById("delete_id").value = id;
      document.getElementById("deleteModal").classList.remove("hidden");
    }

    function closeDeleteModal() {
      document.getElementById("deleteModal").classList.add("hidden");
    }

    // ======== Format Input ========
    function formatRibuan(value) {
      return value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }

    function angkaMurni(value) {
      return value.replace(/\./g, '');
    }

    function handleInputRibuan(input) {
      input.addEventListener('input', () => {
        let value = input.value.replace(/[^0-9]/g, '');
        input.value = value ? formatRibuan(value) : '';
      });
    }

    function handleInputDesimal(input) {
      input.addEventListener('input', () => {
        let value = input.value.replace(/[^0-9,]/g, '');
        const parts = value.split(',');
        if (parts.length > 2) value = parts[0] + ',' + parts[1];
        parts[0] = formatRibuan(parts[0]);
        input.value = parts.join(',');
      });
    }

    const form = document.querySelector('form[action="/dashboard/bibit"]');
    const jumlahInput = document.getElementById('jumlah');
    const beratInput = document.getElementById('total_berat');
    const hargaInput = document.getElementById('total_harga');

    handleInputRibuan(jumlahInput);
    handleInputDesimal(beratInput);
    handleInputRibuan(hargaInput);

    form.addEventListener('submit', () => {
      jumlahInput.value = angkaMurni(jumlahInput.value);
      hargaInput.value = angkaMurni(hargaInput.value);
      if (beratInput.value) {
        beratInput.value = beratInput.value.replace(/\./g, '').replace(',', '.');
      }
    });

    // ======== Pagination & Filter ========
    function updateTotals() {
      let totalBibit = 0;
      let totalBerat = 0;
      let totalHarga = 0; // <-- tambahin
    
      filteredRows.forEach(row => {
        const jumlahText = row.children[4].innerText.replace(/\./g,'').replace(' ekor','').trim();
        const beratText = row.children[5].innerText.replace(/\./g,'').replace(' kg','').replace(' g','').replace(',', '.').trim();
        const hargaText = row.children[6].innerText.replace(/[^0-9]/g,'').trim(); // <-- ambil angka saja
    
        let jumlah = parseInt(jumlahText) || 0;
        let berat = parseFloat(beratText) || 0;
        let harga = parseInt(hargaText) || 0; // <-- parse harga
    
        totalBibit += jumlah;
        totalBerat += berat;
        totalHarga += harga; // <-- tambahin
      });
    
      if (totalRow) {
        // Format jumlah
        totalRow.children[1].innerText = totalBibit.toLocaleString('id-ID') + ' ekor';
      
        // Format berat
        if (totalBerat < 1) {
          totalRow.children[2].innerText = (totalBerat * 1000).toLocaleString('id-ID') + ' g';
        } else {
          totalRow.children[2].innerText = totalBerat.toLocaleString('id-ID', { 
            minimumFractionDigits: totalBerat % 1 === 0 ? 0 : 2, 
            maximumFractionDigits: 2 
          }) + ' kg';
        }
      
        // Format total harga
        totalRow.children[3].innerText = 'Rp ' + totalHarga.toLocaleString('id-ID');
      }
      
    }
    
    
    function showPage(page) {
      const startIdx = (page - 1) * rowsPerPage;
      const endIdx = startIdx + rowsPerPage;

      allRows.forEach(row => row.style.display = 'none');
      filteredRows.forEach((row, index) => {
        if (index >= startIdx && index < endIdx) row.style.display = '';
      });

      const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
      document.getElementById("pageInfo").innerText = `Page ${page} of ${totalPages || 1}`;
      document.getElementById("prevBtn").disabled = page === 1;
      document.getElementById("nextBtn").disabled = page === totalPages || totalPages === 0;

      updateTotals();
    }

    function changePage(direction) {
      if (direction === "prev" && currentPage > 1) currentPage--;
      else if (direction === "next" && currentPage < Math.ceil(filteredRows.length / rowsPerPage)) currentPage++;
      showPage(currentPage);
    }

    filterSelect.addEventListener('change', () => {
      const selectedKolam = filterSelect.value;
      filteredRows = allRows.filter(row => selectedKolam === 'all' || row.dataset.kolamId === selectedKolam);
      currentPage = 1;
      showPage(currentPage);
    });

    // ======== Default tanggal ========
    document.addEventListener("DOMContentLoaded", () => {
      const tebarInput = document.getElementById("tanggal_tebar");
      if (tebarInput && !tebarInput.value) {
        const today = new Date();
        tebarInput.value = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
      }
      showPage(currentPage);
    });

    return { openEditModal, closeEditModal, openDeleteModal, closeDeleteModal, changePage };
  })();
</script>

{% endblock %}
