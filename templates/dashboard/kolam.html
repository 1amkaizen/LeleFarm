<!-- templates/dashboard/kolam.html -->
{% extends "dashboard/base.html" %}
{% block title %}Kelola Kolam{% endblock %}

{% block content %}


<!-- ===== PAGE HEADER + BREADCRUMB ===== -->
<div class="mb-8 mt-5">
  <!-- Breadcrumb -->
  <nav class="text-sm text-gray-500 mb-2">
    <ol class="flex items-center space-x-2">
      <li class="hover:text-blue-600 transition">
        <i class="fas fa-home mr-1"></i> Dashboard
      </li>
      <li>/</li>
      <li class="text-blue-700 font-semibold">
        Kolam
      </li>
    </ol>
  </nav>

  <!-- Page Title -->
  <div class="flex items-center gap-4 
              bg-gradient-to-r from-blue-500 to-blue-600 
              text-white p-5 rounded-2xl shadow-lg">

    <!-- Icon -->
    <div class="bg-white/20 p-3 rounded-xl">
      <i class="fas fa-water text-2xl"></i>
    </div>

    <!-- Title -->
    <div>
      <h1 class="text-2xl font-bold leading-tight">
        Kelola Kolam
      </h1>
      <p class="text-sm text-blue-100">
        Manajemen kolam, kapasitas, dan status panen
      </p>
    </div>
  </div>
</div>




<form action="/dashboard/kolam" method="post" class="bg-white/90 backdrop-blur-2xl p-8 rounded-3xl shadow-[0_20px_50px_rgba(8,_112,_184,_0.1)] border border-white mb-8
         transition-all duration-500 hover:shadow-[0_30px_60px_rgba(8,_112,_184,_0.15)]">

  <div class="flex items-center gap-3 mb-6">
    <div class="h-8 w-1.5 bg-blue-600 rounded-full"></div>
    <h2 class="text-xl font-bold text-gray-800 tracking-tight">Tambah Kolam Baru</h2>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

    <div class="relative group lg:col-span-2">
      <label for="kolam_baru"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-water text-blue-500"></i>
        Nama Kolam
      </label>
      <input type="text" id="kolam_baru" name="kolam_baru" placeholder="Misal: Kolam Bioflok A1" class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5
               shadow-inner transition-all duration-300
               focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-100 focus:outline-none
               hover:border-blue-300 placeholder:text-gray-400" />
    </div>

    <div class="relative group">
      <label for="kapasitas_bibit"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-fish text-indigo-500"></i>
        Kapasitas
      </label>
      <div class="relative">
        <input type="text" id="kapasitas_bibit" name="kapasitas_bibit" placeholder="0" inputmode="numeric" class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5 pr-12
                 shadow-inner transition-all duration-300
                 focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 focus:outline-none
                 hover:border-indigo-300" />
        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400">EKOR</span>
      </div>
    </div>

    <div class="relative group">
      <label for="tanggal_mulai"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-calendar-day text-orange-500"></i>
        Tanggal Mulai
      </label>
      <input type="date" id="tanggal_mulai" name="tanggal_mulai" class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5
               shadow-inner transition-all duration-300
               focus:bg-white focus:border-orange-500 focus:ring-4 focus:ring-orange-100 focus:outline-none
               hover:border-orange-300 cursor-pointer" />
    </div>

    <div class="relative group lg:col-span-2">
      <label for="catatan"
        class="flex items-center gap-2 mb-2 ml-1 text-sm font-bold text-gray-700 uppercase tracking-wider">
        <i class="fas fa-comment-alt text-emerald-500"></i>
        Catatan Tambahan
      </label>
      <textarea id="catatan" name="catatan" rows="1" placeholder="Tambahkan info pakan atau kondisi bibit..." class="w-full rounded-2xl border-gray-200 bg-gray-50/50 px-5 py-3.5
               shadow-inner transition-all duration-300 resize-none
               focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 focus:outline-none
               hover:border-emerald-300 min-h-[54px]"></textarea>
    </div>

  </div>

  <div class="mt-8 flex justify-end items-center gap-4">
    <p class="hidden md:block text-xs text-gray-400 font-medium">
      <i class="fas fa-info-circle mr-1"></i> Pastikan semua data sudah benar sebelum menyimpan.
    </p>
    <button type="submit" class="group relative w-full md:w-auto overflow-hidden px-8 py-3.5 rounded-2xl font-bold text-white
             bg-blue-600 transition-all duration-300 hover:bg-indigo-600
             active:scale-95 flex items-center justify-center gap-3">
      <span class="relative z-10 flex items-center gap-2">
        <i class="fas fa-plus text-sm group-hover:rotate-90 transition-transform duration-300"></i>
        Simpan Data Kolam
      </span>
    </button>
  </div>
</form>

<hr class="my-6" />
<h2 class="text-xl font-semibold mb-2 flex items-center gap-2 text-blue-900">
  <i class="fas fa-list text-indigo-500"></i> Daftar Kolam
</h2>

<!-- Tabel Kolam -->
<div class="overflow-x-auto mb-5 rounded-2xl shadow-lg ring-1 ring-black/5 bg-white">
  <table id="kolamTable" class="w-full md:min-w-[900px] table-auto text-sm text-gray-700">

    <!-- HEADER -->
    <thead class="bg-gradient-to-r from-blue-600 to-blue-500 text-white">
      <tr>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">ID</th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-water mr-1"></i> Nama Kolam
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-sort-numeric-up mr-1"></i> Kapasitas
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-calendar-alt mr-1"></i> Tanggal Mulai
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap">
          <i class="fas fa-sticky-note mr-1"></i> Catatan
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap text-center">
          <i class="fas fa-check-circle mr-1"></i> Status
        </th>
        <th class="px-4 py-3 font-semibold whitespace-nowrap text-center">
          <i class="fas fa-cogs mr-1"></i> Aksi
        </th>
      </tr>
    </thead>

    <!-- BODY -->
    <tbody class="divide-y divide-gray-100 bg-white">
      {% for kolam in kolam_list %}
      <tr class="kolamRow hover:bg-blue-50/70 transition-all duration-200 group">
        <td class="px-4 py-3 whitespace-nowrap font-medium">
          {{ kolam.id }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap font-semibold text-gray-800">
          {{ kolam.nama_kolam }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap">
          {{ "{:,}".format(kolam.kapasitas_bibit).replace(',', '.') }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap">
          {{ kolam.tanggal_mulai }}
        </td>

        <td class="px-4 py-3 whitespace-nowrap text-gray-600 max-w-xs truncate">
          {{ kolam.catatan|default('Tidak ada catatan') }}
        </td>

        <!-- STATUS -->
        <td class="px-4 py-3 whitespace-nowrap text-center">
          <form method="post" action="/dashboard/kolam/status" class="flex items-center justify-center">
            <input type="hidden" name="kolam_id" value="{{ kolam.id }}" />

            <select name="status" onchange="this.form.submit()" class="text-xs font-semibold px-3 py-1.5 rounded-full border-none outline-none cursor-pointer transition
                {% if kolam.status_panen == 'sudah' %}
                  bg-green-100 text-green-700 hover:bg-green-200
                {% else %}
                  bg-red-100 text-red-700 hover:bg-red-200
                {% endif %}">
              <option value="belum" {% if kolam.status_panen=='belum' %}selected{% endif %}>
                Belum Panen
              </option>
              <option value="sudah" {% if kolam.status_panen=='sudah' %}selected{% endif %}>
                Sudah Panen
              </option>
            </select>
          </form>
        </td>

        <!-- AKSI -->
        <td class="px-4 py-3 whitespace-nowrap">
          <div class="flex flex-nowrap items-center justify-center gap-2">

            <button {% if kolam.status_panen=='sudah' %}disabled{% endif %} class="inline-flex items-center justify-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-semibold text-white transition
                bg-yellow-400 hover:bg-yellow-500
                {% if kolam.status_panen == 'sudah' %}
                  opacity-50 cursor-not-allowed
                {% endif %}" onclick="openEditModal(
                {{ kolam.id }},
                '{{ kolam.nama_kolam }}',
                {{ kolam.kapasitas_bibit }},
                '{{ kolam.tanggal_mulai }}',
                '{{ kolam.catatan|default('') }}'
              )">
              <i class="fas fa-edit"></i>
            </button>

            <button type="button" class="inline-flex items-center justify-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-semibold text-white transition
                     bg-red-500 hover:bg-red-600" onclick="openDeleteModal({{ kolam.id }})">
              <i class="fas fa-trash-alt"></i>
            </button>

          </div>
        </td>

      </tr>
      {% endfor %}
    </tbody>

  </table>
</div>



<!-- Pagination Controls -->
<div id="paginationControls" class="flex items-center justify-center gap-3 mt-6 mb-6">

  <button id="prevBtn" onclick="changePage('prev')" disabled class="flex items-center justify-center w-11 h-11 rounded-full
           bg-white border border-blue-300 text-blue-600
           hover:bg-blue-600 hover:text-white
           shadow-md transition-all duration-200
           disabled:opacity-40 disabled:cursor-not-allowed">
    <i class="fas fa-chevron-left text-sm"></i>
  </button>

  <span id="pageInfo" class="px-5 py-2 rounded-full bg-blue-100 text-blue-800
           font-semibold text-sm shadow-inner">
    Page 1
  </span>

  <button id="nextBtn" onclick="changePage('next')" disabled class="flex items-center justify-center w-11 h-11 rounded-full
           bg-white border border-blue-300 text-blue-600
           hover:bg-blue-600 hover:text-white
           shadow-md transition-all duration-200
           disabled:opacity-40 disabled:cursor-not-allowed">
    <i class="fas fa-chevron-right text-sm"></i>
  </button>

</div>



<!-- Modal Edit Kolam -->
<div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative">
    <h2 class="text-lg font-semibold text-blue-900 mb-4">Edit Kolam</h2>
    <form id="editForm" method="post" action="/dashboard/kolam/edit">
      <input type="hidden" name="kolam_id" id="edit_id" />
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900">Nama Kolam</label>
        <input type="text" id="edit_nama" name="nama_kolam"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300 focus:outline-none" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900">Kapasitas</label>
        <input type="number" id="edit_kapasitas" name="kapasitas_bibit"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300 focus:outline-none" />
      </div>
      <div>
        <label for="tanggal_mulai" class="block font-medium text-blue-900"><i
            class="fas fa-calendar-alt text-yellow-500"></i> Tanggal Mulai</label>
        <input type="date" id="edit_tanggal" name="tanggal_mulai"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300 focus:outline-none" />

      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium text-blue-900">Catatan</label>
        <textarea id="edit_catatan" name="catatan"
          class="border rounded p-2 w-full focus:ring-2 focus:ring-blue-300 focus:outline-none"></textarea>
      </div>
      <div class="flex justify-end gap-2">
        <button type="button" onclick="closeEditModal()"
          class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Batal</button>
        <button type="submit" class="px-4 py-2 rounded bg-blue-500 hover:bg-blue-600 text-white">Simpan</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Delete Kolam -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-sm p-6 relative">
    <h2 class="text-lg font-semibold text-blue-900 mb-4">Hapus Kolam?</h2>
    <form id="deleteForm" method="post" action="/dashboard/kolam/delete">
      <input type="hidden" name="kolam_id" id="delete_id" />
      <div class="flex justify-end gap-2">
        <button type="button" onclick="closeDeleteModal()"
          class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Batal</button>
        <button type="submit" class="px-4 py-2 rounded bg-red-500 hover:bg-red-600 text-white">Hapus</button>
      </div>
    </form>
  </div>
</div>


<script>
  function openEditModal(id, nama, kapasitas, tanggal, catatan) {
    document.getElementById('edit_id').value = id;
    document.getElementById('edit_nama').value = nama;
    document.getElementById('edit_kapasitas').value = kapasitas;
    document.getElementById('edit_tanggal').value = tanggal;
    document.getElementById('edit_catatan').value = catatan;
    document.getElementById('editModal').classList.remove('hidden');
  }
  function closeEditModal() {
    document.getElementById('editModal').classList.add('hidden');
  }

  function openDeleteModal(id) {
    document.getElementById('delete_id').value = id;
    document.getElementById('deleteModal').classList.remove('hidden');
  }
  function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
  }
</script>
<script>
  // Set default tanggal mulai ke hari ini saat halaman load
  document.addEventListener('DOMContentLoaded', () => {
    const tanggalInput = document.getElementById('tanggal_mulai');
    if (tanggalInput && !tanggalInput.value) {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      tanggalInput.value = `${yyyy}-${mm}-${dd}`;
    }

    // Buat juga modal edit default tanggal
    const editTanggal = document.getElementById('edit_tanggal');
    if (editTanggal && !editTanggal.value) {
      editTanggal.value = `${yyyy}-${mm}-${dd}`;
    }
  });
</script>
<script>
  const rowsPerPage = 5;  // Jumlah baris per halaman
  let currentPage = 1;

  // Ambil semua baris dalam tabel
  const kolamRows = document.querySelectorAll('.kolamRow');
  const totalRows = kolamRows.length;
  const totalPages = Math.ceil(totalRows / rowsPerPage);

  // Fungsi untuk menampilkan halaman yang sesuai
  function showPage(page) {
    // Tentukan indeks mulai dan selesai
    const startIdx = (page - 1) * rowsPerPage;
    const endIdx = startIdx + rowsPerPage;

    // Sembunyikan semua baris
    kolamRows.forEach((row, index) => {
      if (index >= startIdx && index < endIdx) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });

    // Update informasi halaman
    document.getElementById('pageInfo').innerText = `Page ${page} of ${totalPages}`;

    // Disable previous/next buttons jika di halaman pertama/terakhir
    document.getElementById('prevBtn').disabled = page === 1;
    document.getElementById('nextBtn').disabled = page === totalPages;
  }

  // Fungsi untuk berpindah halaman
  function changePage(direction) {
    if (direction === 'prev' && currentPage > 1) {
      currentPage--;
    } else if (direction === 'next' && currentPage < totalPages) {
      currentPage++;
    }

    showPage(currentPage);
  }

  // Tampilkan halaman pertama saat pertama kali load
  showPage(currentPage);
</script>

<script>
  const kapasitasInput = document.getElementById('kapasitas_bibit');

  kapasitasInput.addEventListener('input', function () {
    // Ambil angka saja
    let value = this.value.replace(/\D/g, '');

    if (!value) {
      this.value = '';
      return;
    }

    // Format ke ribuan Indonesia (1.000)
    this.value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
  });

  // Sebelum submit, kirim angka murni ke backend
  kapasitasInput.form.addEventListener('submit', function () {
    kapasitasInput.value = kapasitasInput.value.replace(/\./g, '');
  });
</script>

{% endblock %}